# DOM 事件

## DOM0 事件处理程序

每个元素都有小写的事件处理程序属性。比如 onclick 。需要把这个属性赋值一个函数。

```javascript
let xkcBtn = document.getElementById("xkc");
xkcBtn.onclick = function () {
    console.log("click");
};
```

事件处理程序会在元素的作用域中运行，因此 this 等于元素。

```javascript
let xkcBtn = document.getElementById("xkc");
xkcBtn.onclick = function () {
    console.log(this.id); // xkc
};
```

通过将事件处理程序属性的值设置为 null ，可以移除通过 DOM0 方式添加的事件处理程序。

```javascript
xkcBtn.onclick = null;
```

## DOM2 事件处理程序

DOM2 Events 为事件处理程序的赋值和移除有两个方法：`addEventListener()` 和 `removeEventListener()`。接收 3 个参数：事件名称、事件处理函数 和 一个布尔值，true 表示在捕获阶段调用，false 表示在冒泡阶段调用，默认为 false。

```javascript
let xkcBtn = document.getElementById("xkc");
xkcBtn.addEventListener("click", function () {
    console.log(this.id); // xkc
}, false);
```

可以同个事件添加多个事件处理程序。

```javascript
let xkcBtn = document.getElementById("xkc");
xkcBtn.addEventListener("click", function () {
  console.log(this.id);
});
xkcBtn.addEventListener("click", function () {
  console.log("小卡车加油！");
});
/*
xkc
小卡车加油！
*/
```

添加多个同名事件处理程序，会以添加事件的顺序触发。

移除事件处理程序，需要传入与添加事件时同样的参数来移除。因此 `addEventListener()` 添加的匿名函数无法移除

```javascript
let xkcBtn = document.getElementById("xkc");
xkcBtn.addEventListener("click", function () {
    console.log(this.id);
}, false);
// 以下移除代码无效！
xkcBtn.removeEventListener("click", function () {
    console.log(this.id);
}, false);
```

必须使用给事件处理程序传入一个事件处理的函数名。

```javascript
let xkcBtn = document.getElementById("xkc");
let handler = function () {
    console.log(this.id);
};
xkcBtn.addEventListener("click", handler, false);
// 移除（有效）
xkcBtn.removeEventListener("click", handler, false);
```

## IE 事件处理程序

IE 独有的事件处理程序的添加和移除方法：`attachEvent()` 和 `detachEvent()` 。都接收两个参数：事件处理程序的名称和事件处理函数。且只支持冒泡阶段。

```javascript
var xkcBtn = document.getElementById("xkc");
xkcBtn.attachEvent("onclick", function () {
    console.log("click");
});
```

在 `attachEvent()` 和 `detachEvent()` 中，事件处理程序是在全局作用域中运行的。因此 this 等于 window。

```javascript
var xkcBtn = document.getElementById("xkc");
xkcBtn.attachEvent("onclick", function () {
    console.log(this === window); // true
});
```

可以添加多个同名事件处理函数。

```javascript
var xkcBtn = document.getElementById("xkc");
xkcBtn.attachEvent("onclick", function () {
  console.log(this === window); // true
});
xkcBtn.attachEvent("onclick", function () {
  console.log("小卡车加油！");
});
/*
小卡车加油！
true
*/
```

执行顺序是添加的事件的顺序反向触发。

移除事件和 DOM2 事件一致。

```javascript
var xkcBtn = document.getElementById("xkc");
var handler = function () {
  console.log("click");
};
xkcBtn.attachEvent("click", handler);
// 移除（有效）
xkcBtn.detachEvent("click", handler);
```

## 跨浏览器事件处理程序

```javascript
var EventUtil = {
  // 添加事件处理程序
  addHandler: function (element, type, handler, isCapture) {
    if (element.addEventListener) {
      element.addEventListener(type, handler, isCapture);
    } else if (element.attachEvent) {
      element.attachEvent("on" + type, handler);
    } else {
      element["on" + type] = handler;
    }
  },
  // 移除事件处理程序
  removeHandler: function (element, type, handler, isCapture) {
    if (element.removeEventListener) {
      element.removeEventListener(type, handler, isCapture);
    } else if (element.detachEvent) {
      element.detachEvent("on" + type, handler);
    } else {
      element["on" + type] = null;
    }
  }
};
```

