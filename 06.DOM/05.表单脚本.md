# 表单脚本

## 表单基础

Web 表单在 HTML 中以 <form> 元素表示，在 JavaScript 中则以 HTMLFormElement 类型表示。

- `acceptCharset`：服务器可以接收的字符集，等价于 HTML 的 accept-charset 属性。
- `action`：请求的 URL，等价于 HTML  的 action 属性。
- `elements`：表单中所有控件的 HTMLCollection。
- `enctype`：请求的编码类型，等价于 HTML 的 enctype 属性。
- `length`：表单中控件的数量。
- `method`：HTTP  请求的方法类型，通常是 "get" 或 "post"，等价于 HTML 的 method 属性。
- `name`：表单的名字，等价于 HTML 的 name 属性。
- `reset()`：把表单字段重置为各自的默认值。
- `submit()`：提交表单。
- `target`：用于发送请求和接收响应的窗口名字，等价于 HTML 的 target 属性。

取得对 <form> 元素的引用。

```javascript
// 通过 id 获取表单引用
let form = document.getElementById("form1");
// 通过索引获取表单引用
let firstForm = document.forms[0];
// 通过表单 name 属性获取引用
let xkcForm = document.forms["xkcForm"];
```

### 提交表单

表单的提交按钮可以使用 type 属性为 "submit" 的 <input> 或 <button> 元素来定义，图片按钮可以使用 type 属性为 "image" 的 <input> 元素来定义。

```html
<!-- 通用提交按钮 -->
<input type="submit" value="Submit Form">
<!-- 自定义提交按钮 -->
<button type="submit">Submit Form</button>
<!-- 图片按钮提交 -->
<input type="image" src="xkc.png">
```

表单上有任意一种提交按钮，且焦点在表单中某个控件上，按回车键可以提交表单（textarea 控件忽略，回车键不发生提交，而是发生换行）。

阻止默认行为可以取消提交表单。

```javascript
let form = document.getElementById("xkcForm");
form.addEventListener("submit", function(event) {
    event.preventDefault();
});
```

可以调用 `submit()` 方法来提交表单。

```javascript
form.submit();
```

**注意：**

通过 `submit()` 方法提交表单时， submit 事件不会触发。 因此需要在 `submit()` 方法前面先进行提交数据验证。

多次提交表单的解决方式：

- 在表单提交后禁用提交按钮；
- 通过 `onsubmit` 事件处理程序取消之后的表单提交。

### 重置表单

重置按钮可以使用 type 属性为 "reset" 的<input> 或<button> 元素来创建。

```html
<!-- 通用重置按钮 -->
<input type="reset" value="Reset Form">
<!-- 自定义重置按钮 -->
<button type="reset">Reset Form</button>
```

重置表单之后，整个表单会重置回第一次渲染时的状态。

阻止重置表单行为，可以通过阻止默认行为

```javascript
let form = document.getElementById("xkc");
form.addEventListener("reset", (event) => {
    event.preventDefault();
});
```

重置表单可以通过调用 `reset()` 方法来完成。

```javascript
form.reset();
```

**注意：**

与 `submit()` 方法不同的是，调用 `reset()` 方法会触发 reset 事件。一般不推荐重置表单的操作。

### 表单字段

所有表单都是表单 elements 属性中包含的一个值。这个 `elements` 集合是一个有序列表，包含对表单中所有字段的引用。可以通过索引位置和 name 属性来访问。

```javascript
let form = document.getElementById("xkcForm");
// 根据索引获取
let field1 = form.elements[0];
// 根据 name 属性获取
let field2 = form.elements["text1"];
let fieldCount = form.elements.length;
```

#### 表单字段的公共属性：

- `disabled`：布尔值，表示表单字段是否禁用。
- `form`：指针，指向表单字段所属的表单。只读。
- `name`：字符串，这个字段的名字。
- `readOnly`：布尔值，表示这个字段是否只读。
- `tabIndex`：数值，表示这个字段在按 Tab 键时的切换顺序。
- `type`：字符串，表示字段类型。
- `value`：要提交给服务器的字段值。只读。

#### 表单字段的公共方法：

两个公共方法：`focus()` 和 `blur()`。

- `focus()`：把浏览器焦点设置到表单字段。如果被修改的字段是 type 是 "hidden" 的 <input> 元素，或者该字段被 CSS 属性 display 或 visibility 隐藏了，则报错。

  HTML5 为表单字段增加了 `autofocus` 属性，支持的浏览器会自动为带有该属性的元素设置焦点。该属性是布尔值。

  **注意：**

  默认下只能给表单元素设置焦点。也可以通过将 tabIndex 属性设置为 -1 再调用 `focus()` 可以给任意元素设置焦点。

- `blur()`：用于从元素上移除焦点。

  

#### 表单字段的公共事件：

- `blur`：在字段失去焦点时触发。
- `change`：在<input> 和 <textarea> 元素的 value 发生变化且失去焦点时触发，在 <select> 元素被选中时发生变化时触发。
- `focus`：在字段获得焦点时触发。

blur 和 focus 事件会因为用户手动改变字段焦点或者使用 `blur()` 或 `focus()` 方法而触发。

## 文本框编程

### 选择文本

`select()` 方法用于全部选中文本框中的文本。

#### select 事件

`select` 事件在当选中文本框中的文本时，会触发。

#### 取得选中文本

为提供选中文本信息。 HTML5 对此进行了扩展，为文本框添加了两个属性：`selectionStart` 和 `selectionEnd`。分别表示文本选区的起点和终点（文本选区起点的偏移量和文本选区终点的偏移量）。

老版本IE有包含整个文档中文本选择信息的 `document.selection` 对象。必须先创建一个范围。再从中取得文本。

```javascript
function getSelectedText(textbox) {
    if (typeof textbox.selectionStart == "number") {
        return textbox.value.substring(textbox.selectionStart, textbox.selectionEnd);
    } else if (document.selection) {
        return document.selection.createRange().text;
    }
}
```

#### 部分选中文本

HTML5 在文本框中选中部分文本提供支持。 `setSelectionRange()` 方法也可以在所有文本框中使用。这个方法接收两个参数：要选择的第一个字符的索引和停止选择的字符的索引。

**注意：**

在调用 `setSelectionRange()` 方法之前要先给文本框设置焦点。

IE早期版本提供的 `createTextRange()` 方法创建一个范围，并使用 `moveStart()` 和 `moveEnd()`范围方法。在使用这两个方法之前需要先调用 `collapse()` 方法把范围折叠到文本框的开始。接着，`moveStart()` 可以把范围的起点和终点都移动到相同的位置，再给 `moveEnd()`传入要选择的字符总数作为参数。最后使用 `select()`选中文本。

```javascript
let textbox = document.forms[0].elements["textbox1"];
textbox.value = "Hello World!";
var range = textbox.createTextRange();
range.collapse(true);
range.moveStart("charactor", 0);
range.moveEnd("charactor", textbox.value.length); 
range.select(); // Hello World!

range.collapse(true);
range.moveStart("charactor", 0);
range.moveEnd("charactor", 3);
range.select(); // Hel
```

**注意：**

要想看到效果文本框必须先获得焦点。

#### 输入过滤

#### 屏蔽字符

例

```javascript
// 用户输入手机号文本框不应该出现非数字字符
textbox.addEventListener("keypress", (event) => {
    if (!/\d/.test(String.fromCharCode(event.charCode)) && event.charCode > 9 && !event.ctrlKey) {
        event.preventDefault();
    }
});
```

